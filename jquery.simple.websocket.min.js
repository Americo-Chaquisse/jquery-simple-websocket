!function(a){var b=function(){var b,c,e=null,f=[],g=function(b){var c;if(c=b.protocols?"undefined"!=typeof window.MozWebSocket?new MozWebSocket(b.url,b.protocols):window.WebSocket?new WebSocket(b.url,b.protocols):null:"undefined"!=typeof window.MozWebSocket?new MozWebSocket(b.url):window.WebSocket?new WebSocket(b.url):null,!c)throw new Error("Error, websocket could not be initialized.");return a(c).bind("open",b.open).bind("close",b.close).bind("message",function(c){var d=a.evalJSON(c.originalEvent.data);b[c.type]&&b[c.type].call(this,d)}).bind("error",function(a){b.error&&b.error.call(this,a)}),c},h=function(){var d=jQuery.Deferred();if(c){if(1===c.readyState)return d.resolve(c),d.promise();c.close()}return c=g(a.extend(b,{open:function(a){var b=this;d&&d.resolve(b)},close:function(a){for(var b=0,c=f.length;c>b;b++)f[b].deferred.resolve();d&&d.rejectWith(a)},message:function(a){for(var b=0,c=f.length;c>b;b++)try{f[b].deferred.notify(a)}catch(d){f[b].deferred.reject(d)}},error:function(a){d&&d.rejectWith(a)}})),d.promise()},j=function(){c&&(c.close(),c=null,e=null)},k=function(){return null!==c&&1===c.readyState},l=function(){return e&&"pending"===e.state()||(_reConnectTries=p(b,"attempts",60),e=jQuery.Deferred()),c&&1===c.readyState?e.resolve(c):h().done(function(){e.resolve(c)}).fail(function(a){_reConnectTries-->0?window.setTimeout(function(){l()},p(b,"timeout",1e4)):e.rejectWith(a)}),e.promise()},m=function(a){var b=jQuery.Deferred();return function(a,c){l().done(function(d){d.send(a),b.resolve(c)}).fail(function(a){b.rejectWith(a)})}(JSON.stringify(a),s),b.promise()},n=function(a){for(var b=0,c=f.length;c>b;b++)if(f[b].listener===a)return b;return-1},o=function(a,b){return"undefined"!=typeof a&&null!==a&&"undefined"!=typeof b&&null!==b&&""!==b&&"undefined"!=typeof a[b]&&null!==a[b]&&""!==a[b]},p=function(a,b,c){return o(a,b)?a[b]:c},q=function(a){if(!o(a,"url"))throw new Error("Missing argument, example usage: $.simpleWebSocket({ url: 'ws://127.0.0.1:3000' }); ");b=a},r=function(a){var b=jQuery.Deferred();return l().done(function(){-1!==n(a)?b.reject(new Error("Listener already listening.")):(b.progress(function(){a.apply(this,arguments)}),f.push({deferred:b,listener:a}))}).fail(function(a){b.reject(a)}),b.promise()},s={init:function(a){return q(a),s},connect:function(){return a.extend(s,l())},isConnected:function(a){return a?(a.apply(this,[k()]),s):k()},send:function(b){return a.extend(s,m(b))},listen:function(b){return a.extend(s,r(b))},remove:function(a){var b=n(a);return-1!==b&&(f[i].deferred.resolve(),f.splice(b,1)),s},close:function(){return j(),s}};return s}();a.extend({simpleWebSocket:function(a){return b.init(a),b.close(),b}})}(jQuery);