!function(a){"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){var b=function(){var b,c=window._ws,d=60,e=null,f=[],g=function(b){var c;if(c=b.protocols?"undefined"!=typeof window.MozWebSocket?new MozWebSocket(b.url,b.protocols):window.WebSocket?new WebSocket(b.url,b.protocols):null:"undefined"!=typeof window.MozWebSocket?new MozWebSocket(b.url):window.WebSocket?new WebSocket(b.url):null,!c)throw new Error("Error, websocket could not be initialized.");return a(c).bind("open",b.open).bind("close",b.close).bind("message",function(c){var d=a.evalJSON(c.originalEvent.data);b[c.type]&&b[c.type].call(this,d)}).bind("error",function(a){b.error&&b.error.call(this,a)}),window._ws=c,c},h=function(){var d=a.Deferred();if(c)if(2===c.readyState||3===c.readyState)c.close();else{if(0===c.readyState)return d.promise();if(1===c.readyState)return d.resolve(c),d.promise()}return c=window._ws=g(a.extend(b,{open:function(a){var b=this;d&&d.resolve(b)},close:function(a){d&&d.rejectWith(a)},message:function(a){for(var b=0,c=f.length;c>b;b++)try{f[b].deferred.notify(a)}catch(d){}},error:function(a){c=window._ws=null;for(var b=0,e=f.length;e>b;b++)f[b].deferred.reject(a);d&&d.rejectWith(a)}})),d.promise()},i=function(){c&&(c.close(),c=null,e=null)},j=function(){return null!==c&&1===c.readyState},k=function(){return e&&"pending"===e.state()||(d=o(b,"attempts",60),e=a.Deferred()),c&&1===c.readyState?e.resolve(c):h().done(function(){e.resolve(c)}).fail(function(a){d--,d>0?window.setTimeout(function(){k()},o(b,"timeout",1e4)):e.rejectWith(a)}),e.promise()},l=function(b){var d=a.Deferred();return function(a,b){k().done(function(){c.send(a),d.resolve(b)}).fail(function(a){d.rejectWith(a)})}(JSON.stringify(b),t),d.promise()},m=function(a){for(var b=0,c=f.length;c>b;b++)if(f[b].listener===a)return b;return-1},n=function(a,b){return"undefined"!=typeof a&&null!==a&&"undefined"!=typeof b&&null!==b&&""!==b&&"undefined"!=typeof a[b]&&null!==a[b]&&""!==a[b]},o=function(a,b,c){return n(a,b)?a[b]:c},p=function(a){if(!n(a,"url"))throw new Error("Missing argument, example usage: $.simpleWebSocket({ url: 'ws://127.0.0.1:3000' }); ");b=a},q=function(b){var c=a.Deferred();return k().done(function(){c.progress(function(){b.apply(this,arguments)}),s(b),f.push({deferred:c,listener:b})}).fail(function(a){c.reject(a)}),c.promise()},r=function(a){q(a).fail(function(){r(a)})},s=function(a){var b=m(a);-1!==b&&f.splice(b,1)},t={init:function(a){return p(a),t},connect:function(){return a.extend(t,k())},isConnected:function(a){return a?(a.apply(this,[j()]),t):j()},send:function(b){return a.extend(t,l(b))},listen:function(b){return a.extend(t,r(b))},remove:function(a){return s(a),t},removeAll:function(){return f=[],t},close:function(){return i(),t}};return t}();a.extend({simpleWebSocket:function(a){return b.init(a),b}})});